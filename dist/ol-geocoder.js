/*!
 * ol-geocoder - v4.1.0
 * A geocoder extension for OpenLayers.
 * https://github.com/jonataswalker/ol-geocoder
 * Built: Fri Oct 16 2020 12:22:08 GMT-0700 (Pacific Daylight Time)
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ol/control/Control"),require("ol/style/Style"),require("ol/style/Icon"),require("ol/layer/Vector"),require("ol/source/Vector"),require("ol/geom/Point"),require("ol/Feature"),require("ol/proj")):"function"==typeof define&&define.amd?define(["ol/control/Control","ol/style/Style","ol/style/Icon","ol/layer/Vector","ol/source/Vector","ol/geom/Point","ol/Feature","ol/proj"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).Geocoder=t(e.ol.control.Control,e.ol.style.Style,e.ol.style.Icon,e.ol.layer.Vector,e.ol.source.Vector,e.ol.geom.Point,e.ol.Feature,e.ol.proj)}(this,(function(e,t,n,r,s,o,i,a){"use strict";function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=l(e),c=l(t),p=l(n),d=l(r),h=l(s),m=l(o),g=l(i),y=l(a),f="gcd-container",v="gcd-button-control",b="gcd-input-query",w="gcd-input-reset",x={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",address:"gcd-address",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},k={containerId:f,buttonControlId:v,inputQueryId:b,inputResetId:w,cssClasses:x},q=Object.freeze({__proto__:null,containerId:f,buttonControlId:v,inputQueryId:b,inputResetId:w,cssClasses:x,default:k}),C="addresschosen",S="nominatim",L="reverse",E="glass-button",A="text-input",T="osm",j="mapquest",F="photon",N="bing",R="opencage",P={provider:T,placeholder:"Search for an address",featureStyle:null,targetType:E,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,autoCompleteTimeout:200,debug:!1};function I(e,t){if(void 0===t&&(t="Assertion failed"),!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}function _(e){var t=function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}return window.performance.now()}().toString(36);return e?e+t:t}function M(e){return/^[0-9]+$/.test(e)}function O(e,t,n){if(Array.isArray(e))e.forEach((function(e){return O(e,t)}));else for(var r=Array.isArray(t)?t:t.split(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+/),s=r.length;s--;)V(e,r[s])||G(e,r[s],n)}function D(e,t,n){if(Array.isArray(e))e.forEach((function(e){return D(e,t,n)}));else for(var r=Array.isArray(t)?t:t.split(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+/),s=r.length;s--;)V(e,r[s])&&z(e,r[s],n)}function V(e,t){return e.classList?e.classList.contains(t):U(t).test(e.className)}function Q(e,t){return e.replace(/\{[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*([\x2D0-9A-Z_a-z]+)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\}/g,(function(e,n){var r=void 0===t[n]?"":t[n];return String(r).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}))}function B(e,t){var n;if(Array.isArray(e)){if(n=document.createElement(e[0]),e[1].id&&(n.id=e[1].id),e[1].classname&&(n.className=e[1].classname),e[1].attr){var r=e[1].attr;if(Array.isArray(r))for(var s=-1;++s<r.length;)n.setAttribute(r[s].name,r[s].value);else n.setAttribute(r.name,r.value)}}else n=document.createElement(e);n.innerHTML=t;for(var o=document.createDocumentFragment();n.childNodes[0];)o.append(n.childNodes[0]);return n.append(o),n}function U(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)","u")}function G(e,t,n){e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&M(n)&&window.setTimeout((function(){return z(e,t)}),n)}function z(e,t,n){e.classList?e.classList.remove(t):e.className=e.className.replace(U(t)," ").trim(),n&&M(n)&&window.setTimeout((function(){return G(e,t)}),n)}var $=q.cssClasses,H=function(e){this.options=e.options,this.els=this.createControl()};H.prototype.createControl=function(){var e,t,n;return this.options.targetType===A?(t=$.namespace+" "+$.inputText.container,n={container:e=B(["div",{id:q.containerId,classname:t}],H.input),control:e.querySelector("."+$.inputText.control),input:e.querySelector("."+$.inputText.input),reset:e.querySelector("."+$.inputText.reset),result:e.querySelector("."+$.inputText.result)}):(t=$.namespace+" "+$.glass.container,n={container:e=B(["div",{id:q.containerId,classname:t}],H.glass),control:e.querySelector("."+$.glass.control),button:e.querySelector("."+$.glass.button),input:e.querySelector("."+$.glass.input),reset:e.querySelector("."+$.glass.reset),result:e.querySelector("."+$.glass.result)}),n.input.placeholder=this.options.placeholder,n},H.glass='\n  <div class="'+$.glass.control+" "+$.olControl+'">\n    <button type="button" id="'+q.buttonControlId+'" class="'+$.glass.button+'"></button>\n    <input type="text" id="'+q.inputQueryId+'" class="'+$.glass.input+'" autocomplete="off" placeholder="Search ...">\n    <a id="'+q.inputResetId+'" class="'+$.glass.reset+" "+$.hidden+'"></a>\n  </div>\n  <ul class="'+$.glass.result+'"></ul>\n',H.input='\n  <div class="'+$.inputText.control+'">\n    <input type="text" id="'+q.inputQueryId+'" class="'+$.inputText.input+'" autocomplete="off" placeholder="Search ...">\n    <span class="'+$.inputText.icon+'"></span>\n    <button type="button" id="'+q.inputResetId+'" class="'+$.inputText.reset+" "+$.hidden+'"></button>\n  </div>\n  <ul class="'+$.inputText.result+'"></ul>\n';var K=function(){this.settings={url:"https://photon.komoot.de/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}};K.prototype.getParameters=function(e){return e.lang=e.lang.toLowerCase(),{url:this.settings.url,params:{q:e.query,limit:e.limit||this.settings.params.limit,lang:this.settings.langs.includes(e.lang)?e.lang:this.settings.params.lang}}},K.prototype.handleResponse=function(e){return 0===e.features.length?[]:e.features.map((function(e){return{lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1],address:{name:e.properties.name,postcode:e.properties.postcode,city:e.properties.city,state:e.properties.state,country:e.properties.country},original:{formatted:e.properties.name,details:e.properties}}}))};var Z=function(){this.settings={url:"https://nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}};Z.prototype.getParameters=function(e){return{url:this.settings.url,params:{q:e.query,format:this.settings.params.format,addressdetails:this.settings.params.addressdetails,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}},Z.prototype.handleResponse=function(e){return 0===e.length?[]:e.map((function(e){return{lon:e.lon,lat:e.lat,address:{name:e.display_name,road:e.address.road||"",houseNumber:e.address.house_number||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}}}))};var J=function(){this.settings={url:"http://open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}};J.prototype.getParameters=function(e){return{url:this.settings.url,params:{q:e.query,key:e.key,format:"json",addressdetails:1,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}},J.prototype.handleResponse=function(e){return 0===e.length?[]:e.map((function(e){return{lon:e.lon,lat:e.lat,address:{name:e.address.neighbourhood||"",road:e.address.road||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}}}))};var W=function(){this.settings={url:"https://dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}};W.prototype.getParameters=function(e){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:e.query,key:e.key,includeNeighborhood:e.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:e.maxResults||this.settings.params.maxResults}}},W.prototype.handleResponse=function(e){var t=e.resourceSets[0].resources;return 0===t.length?[]:t.map((function(e){return{lon:e.point.coordinates[1],lat:e.point.coordinates[0],address:{name:e.name},original:{formatted:e.address.formattedAddress,details:e.address}}}))};var X=function(){this.settings={url:"https://api.opencagedata.com/geocode/v1/json?",params:{q:"",key:"",limit:10,countrycode:"",pretty:1,no_annotations:1}}};function Y(e){return new Promise((function(t,n){var r=function(e,t){t&&"object"==typeof t&&(e+=(/\?/.test(e)?"&":"?")+ee(t));return e}(e.url,e.data);e.jsonp?function(e,t,n){var r=document.head,s=document.createElement("script"),o="f"+Math.round(Math.random()*Date.now());s.setAttribute("src",e+(e.indexOf("?")>0?"&":"?")+t+"="+o),window[o]=function(e){window[o]=void 0,setTimeout((function(){return r.removeChild(s)}),0),n(e)},r.append(s)}(r,e.callbackName,t):fetch(r,{method:"GET",mode:"cors",credentials:"same-origin"}).then((function(e){return e.json()})).then(t).catch(n)}))}function ee(e){return Object.keys(e).reduce((function(t,n){return t.push("object"==typeof e[n]?ee(e[n]):encodeURIComponent(n)+"="+encodeURIComponent(e[n])),t}),[]).join("&")}X.prototype.getParameters=function(e){return{url:this.settings.url,params:{q:e.query,key:e.key,limit:e.limit||this.settings.params.limit,countrycode:e.countrycodes||this.settings.params.countrycodes}}},X.prototype.handleResponse=function(e){return 0===e.results.length?[]:e.results.map((function(e){return{lon:e.geometry.lng,lat:e.geometry.lat,address:{name:e.components.house_number||"",road:e.components.road||"",postcode:e.components.postcode,city:e.components.city||e.components.town,state:e.components.state,country:e.components.country},original:{formatted:e.formatted,details:e.components}}}))};var te=q.cssClasses,ne=function(e,t){this.Base=e,this.layerName=_("geocoder-layer-"),this.layer=new d.default({name:this.layerName,source:new h.default}),this.options=e.options,this.options.provider="string"==typeof this.options.provider?this.options.provider.toLowerCase():this.options.provider,this.provider=this.newProvider(),this.els=t,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners()};return ne.prototype.setListeners=function(){var e,t,n=this;this.els.input.addEventListener("keypress",(function(e){var t=e.target.value.trim();(e.key?"Enter"===e.key:e.which?13===e.which:!!e.keyCode&&13===e.keyCode)&&(e.preventDefault(),n.query(t))}),!1),this.els.input.addEventListener("click",(function(e){return e.stopPropagation()}),!1),this.els.input.addEventListener("input",(function(r){var s=r.target.value.trim();0!==s.length?D(n.els.reset,te.hidden):O(n.els.reset,te.hidden),n.options.autoComplete&&s!==t&&(t=s,e&&clearTimeout(e),e=setTimeout((function(){s.length>=n.options.autoCompleteMinLength&&n.query(s)}),n.options.autoCompleteTimeout))}),!1),this.els.reset.addEventListener("click",(function(e){n.els.input.focus(),n.els.input.value="",n.lastQuery="",O(n.els.reset,te.hidden),n.clearResults()}),!1),this.options.targetType===E&&this.els.button.addEventListener("click",(function(e){e.stopPropagation(),V(n.els.control,te.glass.expanded)?n.collapse():n.expand()}),!1)},ne.prototype.query=function(e){var t=this;this.provider||(this.provider=this.newProvider());var n=this.provider.getParameters({query:e,key:this.options.key,lang:this.options.lang,countrycodes:this.options.countrycodes,limit:this.options.limit});if(this.lastQuery!==e||!this.els.result.firstChild){this.lastQuery=e,this.clearResults(),O(this.els.reset,te.spin);var r={url:n.url,data:n.params};n.callbackName&&(r.jsonp=!0,r.callbackName=n.callbackName),Y(r).then((function(e){t.options.debug&&console.info(e),D(t.els.reset,te.spin);var n=t.provider.handleResponse(e);n&&(t.createList(n),t.listenMapClick())})).catch((function(e){D(t.els.reset,te.spin);var n=B("li","<h5>Error! No internet connection?</h5>");t.els.result.append(n)}))}},ne.prototype.createList=function(e){var t=this,n=this.els.result;e.forEach((function(e){var r;switch(t.options.provider){case T:r='<span class="'+te.road+'">'+e.address.name+"</span>";break;default:r=t.addressTemplate(e.address)}var s=B("li",'<a href="#">'+r+"</a>");s.addEventListener("click",(function(n){n.preventDefault(),t.chosen(e,r,e.address,e.original)}),!1),n.append(s)}))},ne.prototype.chosen=function(e,t,n,r){console.log("*** ol-geocoder place:"),console.log(e);var s=this.Base.getMap(),o=[Number.parseFloat(e.lon),Number.parseFloat(e.lat)],i=s.getView().getProjection(),a=y.default.transform(o,"EPSG:4326",i),l=e.boundingbox;l&&(l=y.default.transformExtent(l,"EPSG:4326",i));var u={formatted:t,details:n,original:r};if(!1===this.options.keepOpen&&this.clearResults(!0),!0===this.options.preventDefault)this.Base.dispatchEvent({type:C,address:u,coordinate:a,bbox:l});else{l?s.getView().fit(l,{duration:500}):function(e,t,n,r){void 0===n&&(n=500),void 0===r&&(r=2.388657133911758),e.getView().animate({duration:n,resolution:r},{duration:n,center:t})}(s,a);var c=this.createFeature(a,u);this.Base.dispatchEvent({type:C,address:u,feature:c,coordinate:a,bbox:l})}},ne.prototype.createFeature=function(e){var t=new g.default(new m.default(e));return this.addLayer(),t.setStyle(this.options.featureStyle),t.setId(_("geocoder-ft-")),this.getSource().addFeature(t),t},ne.prototype.addressTemplate=function(e){var t=[];return e.name&&t.push(['<span class="',te.road,'">{name}</span>'].join("")),(e.road||e.building||e.house_number)&&t.push(['<span class="',te.road,'">{building} {road} {house_number}</span>'].join("")),(e.city||e.town||e.village)&&t.push(['<span class="',te.city,'">{postcode} {city} {town} {village}</span>'].join("")),(e.state||e.country)&&t.push(['<span class="',te.country,'">{state} {country}</span>'].join("")),Q(t.join("<br>"),e)},ne.prototype.newProvider=function(){switch(this.options.provider){case T:return new Z;case j:return new J;case F:return new K;case N:return new W;case R:return new X;default:return this.options.provider}},ne.prototype.expand=function(){var e=this;D(this.els.input,te.spin),O(this.els.control,te.glass.expanded),window.setTimeout((function(){return e.els.input.focus()}),100),this.listenMapClick()},ne.prototype.collapse=function(){this.els.input.value="",this.els.input.blur(),O(this.els.reset,te.hidden),D(this.els.control,te.glass.expanded),this.clearResults()},ne.prototype.listenMapClick=function(){if(!this.registeredListeners.mapClick){var e=this,t=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,t.addEventListener("click",{handleEvent:function(n){e.clearResults(!0),t.removeEventListener(n.type,this,!1),e.registeredListeners.mapClick=!1}},!1)}},ne.prototype.clearResults=function(e){e&&this.options.targetType===E?this.collapse():function(e){for(;e.firstChild;)e.firstChild.remove()}(this.els.result)},ne.prototype.getSource=function(){return this.layer.getSource()},ne.prototype.addLayer=function(){var e=this,t=!1,n=this.Base.getMap();n.getLayers().forEach((function(n){n===e.layer&&(t=!0)})),t||n.addLayer(this.layer)},function(e){function t(n,r){if(void 0===n&&(n=S),void 0===r&&(r={}),!(this instanceof t))return new t;var s;I("string"==typeof n,"@param `type` should be string!"),I(n===S||n===L,"@param 'type' should be '"+S+"'\n      or '"+L+"'!"),I("object"==typeof r,"@param `options` should be object!"),P.featureStyle=[new c.default({image:new p.default({scale:.7,src:"//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png"})})],this.options=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=t[s]);return n}(P,r),this.container=void 0;var o=new H(this);n===S&&(this.container=o.els.container,s=new ne(this,o.els),this.layer=s.layer),e.call(this,{element:this.container})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getLayer=function(){return this.layer},t.prototype.getSource=function(){return this.getLayer().getSource()},t.prototype.setProvider=function(e){this.options.provider=e},t.prototype.setProviderKey=function(e){this.options.key=e},t}(u.default)}));
//# sourceMappingURL=ol-geocoder.js.map
